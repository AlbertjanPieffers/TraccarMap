<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live GPS Tracker (Traccar WebSocket)</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map {
            height: 500px;
            width: 100%;
        }
    </style>
</head>
<body>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // üîπ Traccar WebSocket Configuratie
        const TRACCAR_SERVER = "wss://server.traccar.org/api/socket"; // WebSocket endpoint
        const TRACCAR_USERNAME = "reclameappie@gmail.com";
        const TRACCAR_PASSWORD = "xy3s9e6k";
        const DEVICE_ID = 7919; // Juiste device ID

        let followDevice = true; // üîπ Standaard apparaat volgen

        // üîπ Kaart initialiseren met Leaflet.js (Minimalistische Roadmap)
        let map = L.map('map', { zoomControl: false }).setView([52.3038209, 6.505169], 17); // üîπ Goed ingezoomd (17)
        L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png", {
            attribution: '',
            subdomains: 'abcd',
            minZoom: 2,
            maxZoom: 19
        }).addTo(map);

        // üîπ ECHT auto-icoon (Niet een bougie üòÇ)
        const carIcon = L.icon({
            iconUrl: "https://i.postimg.cc/qgfN3Jjr/car.png", // üöó Auto icoon
            iconSize: [50, 50], // Groter icoon
            iconAnchor: [25, 25] // Centered position
        });

        let marker = L.marker([52.3038209, 6.505169], { icon: carIcon }).addTo(map);

        // üîπ Verbinding maken met Traccar WebSocket
        function connectWebSocket() {
            console.log("üì° Verbinden met Traccar WebSocket...");
            const socket = new WebSocket(TRACCAR_SERVER);

            socket.onopen = function() {
                console.log("‚úÖ Verbonden met Traccar WebSocket!");
                socket.send(JSON.stringify({ action: "login", email: TRACCAR_USERNAME, password: TRACCAR_PASSWORD }));
            };

            socket.onmessage = function(event) {
                const data = JSON.parse(event.data);
                console.log("üìç Nieuwe locatie ontvangen:", data);

                // Check of het een positie-update is
                if (data.positions && data.positions.length > 0) {
                    const position = data.positions.find(pos => pos.deviceId === DEVICE_ID);
                    if (position) {
                        updateMap(position.latitude, position.longitude);
                    }
                }
            };

            socket.onerror = function(error) {
                console.error("‚ùå WebSocket fout:", error);
            };

            socket.onclose = function() {
                console.warn("‚ö†Ô∏è WebSocket verbinding gesloten, opnieuw verbinden in 5 seconden...");
                setTimeout(connectWebSocket, 5000);
            };
        }

        // üîπ Functie om kaart en marker bij te werken + Apparaat volgen
        function updateMap(lat, lon) {
            console.log(`üìç GPS Update: Lat ${lat}, Lon ${lon}`);

            marker.setLatLng([lat, lon]); // Verplaats de marker
            if (followDevice) {
                map.setView([lat, lon]); // üìå Houd de kaart gefocust op het apparaat
            }
        }

        // üîπ WebSocket starten
        connectWebSocket();
    </script>

</body>
</html>
